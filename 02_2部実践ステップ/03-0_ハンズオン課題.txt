第3章：ハンズオン課題
― Kubernetes の振る舞いを体感する ―


■この章の目的
この章では、実際に Kubernetes のリソースを扱いながら、

・第1部で整理した前提
・第2部の前半でそろえた実践環境

が、どのような挙動として現れるのか を確認します。

ここでのゴールは、正しく操作できることやコマンドを覚えること
ではありません。

Kubernetes が何を自動でやり、人が何をやらなくてよいのか
を体感することです。


■この章で大切にする視点
ハンズオンを進める中で、次の点を意識してください。

「自分が何をしたか」より「何が勝手に起きたか」
「失敗しないこと」より「壊れた後の挙動」

Kubernetes は、人の操作を最小限にするための仕組みです。

この章では、あえて壊し、あえて戻ることで、その設計を確認します。

3-1. Pod / Deployment / Service

― 実行単位と責務の分離 ―

■ここで確認したいこと

まずは、Kubernetes の基本となるリソースを扱います。

・Pod
・Deployment
・Service

ここで確認したいのは、「実行単位」と「管理単位」は違うという点です。

やること（概要）

・Pod を作成する
・Pod を削除する
・Deployment を使って Pod を管理する
・レプリカ数を変更する
・Service を通じて、
・Pod にアクセスします。

観察ポイント
この操作の中で、次の点を観察してください。

・Pod を削除したとき、何が起きたか
・自分が指示していない処理は何か
・Deployment が何を肩代わりしているか

ここで重要なのは、

Pod は壊れる前提で扱われているという点です。

Kubernetes では、壊れないようにする のではなく、
壊れたら戻す という設計が採られています。


3-2. ConfigMap / Secret / Volume
― 設定と実行を分離する ―

ここで確認したいことは設定や状態を
扱うリソースを確認します。

・ConfigMap
・Secret
・Volume

ここでのテーマは、設定や状態は
実行単位の外に置かれる
という考え方です。

やること（概要）
・設定を ConfigMap として定義する
・Pod から設定を参照する
・Pod を削除する
・再作成後の挙動を確認する

観察ポイント
・Pod が消えても、何が残っているか
・設定がどこに存在しているか
・なぜ Pod に直接持たせないのか

ここで体感したいのは、Podは使い捨てであるという前提です。

Kubernetes では、「長く動かし続ける」ことよりも、
入れ替えられること が重視されます。


3-3 Ingress（および Gateway）の役割
― 外部との境界はどこに置かれるのか ―

確認事項
この節では、Kubernetes クラスタの外部からのアクセスを扱います。

・Service
・Ingress（および Gateway）

ここでのテーマは、
この節では、実際に通信を成立させる操作は行いません。。

代わりに、
・Service が担っている役割を整理する
・Ingress（または Gateway）が何を定義するリソースなのかを確認する
・なぜ環境によっては Ingress が動かないのかを理解する
といった点を確認します。


■観察ポイント

以下の点を意識してください。

・Service と Ingress は、どちらも「通信を処理する実体」ではない
・Ingress は、外部からの入口を「定義」するリソースである
・実際に通信を処理するのは、Ingress Controller や Gateway である
・Kubernetes は「どうつなぐか」ではなく「どう扱いたいか」を宣言させる仕組みである

I■Service と Ingress の役割整理

ここで、Service と Ingress（Gateway）の役割を整理します。

Service は、

・クラスタ内部の接続点
・Pod の増減を吸収する
・内部通信の責務を担う

リソースです。

一方 Ingress（および Gateway）は、

・クラスタ外部との境界
・外部からのアクセスルールを定義する
・ルーティング方針を記述する

ためのリソースです。

どちらも、アプリケーションの実装ではありません。


■なぜ Ingress はそのままでは動かないのか

Ingress を apply しても、
環境によっては何も起こらない場合があります。

これは設定ミスではありません。

Ingress は「何をしたいか」を表すリソースであり、
実際に通信を処理するのは Ingress Controller や Gateway です。

Kubernetes では、

・やりたいこと（宣言）
・それを実現する実装

が分離されています。

この分離は、これまで見てきた
Deployment や Service の設計と同じ考え方です。


■この節で押さえておきたいこと

この節で理解しておいてほしいのは、次の点です。

Ingress や Gateway は、
通信を便利にするための仕組みではありません。

外部との責務の境界を、
どこに置くかを明確にするための仕組みです。

アプリケーションは通信経路を意識せず、
基盤側が入口とルーティングを引き受ける。

この分離があるからこそ、

・構成を変えられる
・実装を差し替えられる
・環境ごとの差分を吸収できる

という設計が成立しています。


3-4. kubectl の位置づけ
― 操作ではなく観察のために使う ―

確認事項
ハンズオンでは、以下のコマンドを使用します。

・get
・describe
・logs
・exec

ここでの重要なポイントは、

kubectl はKubernetes を操作するための道具ではない
という認識です。

kubectl の役割
kubectl は、何が起きているか、どんな状態になっているか
を観察するための道具 です。

この章では、

・状態を見る
・変化を見る
・差分を見る

ために kubectl を使います。

この章のまとめ

この章でやってきたことは、
Kubernetes を使いこなすこと
操作を覚えること
ではありません。

Kubernetes が壊れる前提の世界で
どう振る舞うかを、実際の挙動として確認しました。

Pod は消える
Deployment は戻す
設定は外に出される
責務は分離される
これらはすべて、第1部で整理した前提の上に成り立っています。

次の章では、この実践環境を離れたときに何が起こるのか、
ローカル環境での注意点 を整理します。