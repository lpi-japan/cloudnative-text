第4章：ローカル環境へ展開する場合の注意点
― 自由が増えるということは、責任が増えるということ ―

この章の目的

第3章までで、KillerCoda を使った実践を通じて、
・Kubernetes の基本的な振る舞い
・壊れる前提での設計
・人が直接操作しない世界

を体感してきました。

この章では、その実践環境を離れ、ローカル環境や実際の現場に戻ったときに
何が変わるのかを整理します。

ここでの目的は、
・ローカル環境での構築方法を覚えること
・トラブルシューティングを網羅すること
ではありません。

環境が変わることで、どんな前提が自分の責任になるのか
を理解することです。

■学習環境とローカル環境の決定的な違い
KillerCoda のような学習環境では、
・初期状態が整っている
・依存関係が揃っている
・想定外の差分が少ない
という前提があります。

一方、ローカル環境では、
・OS
・Docker / container runtime
・ネットワーク設定
・リソース制限
といった要素が、すべて自分の環境依存 になります。

これは、Kubernetes が難しくなったのではありません。
前提を肩代わりしてくれる存在がいなくなったというだけです。

■環境差が表に出る代表的なポイント

▼ネットワーク
ローカル環境では、
・ポートフォワードが必要になる
・名前解決が思った通りにいかない
・外部からアクセスできない
といった問題が起こりがちです。

これは、ネットワークが不安定だからではなく、環境ごとに前提が違うから起こります。

第1部・第4章で整理した通り、
ネットワークは
・遅延する
・切れる
・制御できない要素を含む
という前提の上にあります。

ローカルでは、その前提がより露骨に見える だけです。

▼リソース（CPU / メモリ）
ローカル環境では、
・メモリ不足
・CPU 競合
・プロセスの強制終了
といった問題も起こりやすくなります。

例えば、
・コンテナが突然落ちる
・Pod が再起動を繰り返す

といった挙動は、Kubernetes の不具合ではありません。

多くの場合、Linux がリソースを守るためにプロセスを落としている結果です。

Kubernetes は、
・それを防ぐ存在ではなく
・それを前提として動く存在
である、という点を思い出してください。

▼ストレージ
学習環境では意識しにくかったストレージも、ローカルでは問題になります。
・Volume が期待通りにマウントされない
・データが残らない
・パーミッションで詰まる
といった点です。

ここでも重要なのは、Kubernetes が魔法のストレージを提供しているわけではないという点です。

実体は、
・OS
・ファイルシステム
・マウント設定
に依存しています。

▼「自由」と「責任」の関係
ローカル環境では、
・自由に設定できる
・構成を自分で決められる

一方で、うまくいかなかった理由も自分で引き受ける必要がある
という世界になります。

これは、
・クラウドネイティブが失敗している
・Kubernetes が難しすぎる
という話ではありません。

前提を引き受ける主体が変わっただけです。

▼第1部の前提がどう効いてくるか
ここまで見てきた差分は、すべて第1部で整理した前提とつながっています。
・環境は変わる
・ネットワークは切れる
・リソースは枯渇する
・人がすべてを制御できない
これらの前提は、ローカル環境でより強く意識されます。

Kubernetes は、
・それらを隠すための仕組みではなく、
・それらを前提として人の負担を減らすための仕組みです。

▼この章のまとめ
この章で整理したかったのは、次の一点です。

「環境が変われば、責任の所在も変わる」

・KillerCoda では、多くの前提を環境が肩代わりしていました。
・ローカル環境では、その前提を自分が引き受けます。

どちらが良い・悪い、ではありません。
どの前提を引き受けているのかを自覚しているかどうかが重要です。

これで第2部は、
・体感
・前提差の理解
まで一通り揃いました。

次の部では、これらを踏まえた上で、
・設計
・構成
・運用
といった話に進んでいきます。
